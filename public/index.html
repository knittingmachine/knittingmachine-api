<html>
  <head>
    <title>Debug</title>
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <style>

      *{
        margin:0;
        box-sizing: border-box;
        font-family: sans-serif;
        color:black;
      }

      body{
        width:100%;
        height:100%;
      }
      main{
        width:100%;
        height:100%;
      }
      nav{
        margin-top:20px;
      }

      article{
        margin: 20px 0px 20px 0px;
      }

      .example{
        border: 2px solid black;
        display: flex;
        max-height:400px;
        overflow-y: auto;
        padding:10px 10px 40px 10px;
      }
      .example .code{
        overflow:auto;
      }

      pre {
          white-space: pre-wrap;       /* Since CSS 2.1 */
          white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
          white-space: -pre-wrap;      /* Opera 4-6 */
          white-space: -o-pre-wrap;    /* Opera 7 */
          word-wrap: break-word;       /* Internet Explorer 5.5+ */
          background-color: #e7e7e7;
          padding:4px 4px 4px 4px;
      }

      .divider{
        width:100%;
      }
      button{
        margin:10px 0px;
      }
    </style>
  </head>
  <body>
    <main class="container">
        <section class="columns col-12 one-line">
          <nav class="column col-4">
            <h1>Knitting Machine API</h1>
            <ul>
              <li>Resources</li>
              <li>Sections</li>
              <li>Playlists</li>
              <li>Tags</li>
              <li>Users</li>
            </ul>
          </nav>

          <section class="column col-8">
            <!-- FIND ONE EXAMPLE -->
            <article class="example columns col-12" id="resources-findOne-example">
                <h3>/resources: findAll()</h3>
                <div class="divider"></div>
                <div class="columns one-line col-12">
                  <div class="column col-6">
                    <div class="description">
                        <p>find all the resources and send back an array</p>
                    </div>
                    <div class="url-endpoint">
                        <p class="url-endpoint-title">URL example:</p>
                        <p><code>http://localhost:3030/resources</code></p>
                    </div>
                    <button class="btn" id="resources-findAll">SUBMIT</button>
                  </div>
                  <div class="column col-6">
                    <pre>
                      <code id="resources-findAll-result"></code>
                    </pre>
                  </div>
                </div>
            </article>

            <!-- FIND ONE BY ID -->
            <article class="example columns col-12" id="resources-findById-example">
                <h3>/resources: findById()</h3>
                <div class="divider"></div>
                <div class="columns one-line col-12">
                  <div class="column col-6">
                    <div class="description">
                        <p>find one resource by it's ID and send back an JSON object</p>
                    </div>
                    <div class="url-endpoint">
                        <p class="url-endpoint-title">URL example:</p>
                        <pre><code>http://localhost:3030/resources?_id=5bc507165686ad95c5929953</code></pre>
                    </div>
                    <button class="btn" id="resources-findById">SUBMIT</button>
                  </div>
                  <div class="column col-6">
                    <pre>
                      <code id="resources-findById-result"></code>
                    </pre>
                  </div>
                </div>
            </article>

            <!-- POST RANDOM -->
            <article class="example columns col-12" id="resources-create-example">
                <h3>/resources: create()</h3>
                <div class="divider"></div>
                <div class="columns one-line col-12">
                  <div class="column col-6">
                    <div class="description">
                        <p>create a new resource and send back the new JSON object</p>
                    </div>
                    <div class="url-endpoint">
                        <p class="url-endpoint-title">data being sent:</p>
                        <pre><code>
                      {
                        title:"Test from API, Random Number: " + Math.random()*100,
                        description: "Test from API, Random Number: " + Math.random()*100,
                        url:"DELETEME",
                        keywords: ["TEST", "TEST"],
                        difficulty:["BEGINNER"],
                        imageUrl:"https://raw.githubusercontent.com/knittingmachine/knittingmachine-docs/master/docs/concept/illustrations/img/frustrated-student.png"
                      }
                      </code></pre>
                    </div>
                    <button class="btn" id="resources-create">SUBMIT</button>
                  </div>
                  <div class="column col-6">
                    <pre>
                      <code id="resources-create-result"></code>
                    </pre>
                  </div>
                </div>
            </article>


            <!-- POST -->
            <article class="example columns col-12" id="resources-create-example-form">
                <h3>/resources: create()</h3>
                <div class="divider"></div>
                <div class="columns one-line col-12">
                  <div class="column col-6">
                    <div class="description">
                        <p>create a new resource with form inputs and send back the new JSON object</p>
                    </div>
                    <div class="url-endpoint">
                        <form id="resources-create-form" method="post">
                          <input type="text" name="title" value="" placeholder="title">
                          <input type="text" name="description" value="" placeholder="description">
                          <input type="text" name="url" value="" placeholder="url">
                          <input type="text" name="imageUrl" value="" placeholder="imageUrl">
                          <fieldset>
                            <legend>Difficulty</legend>
                            <label for="create-beginner">beginner</label>
                            <input id="create-beginner" type="radio" name="difficulty" value="beginner">
                            <label for="create-intermediate">intermediate</label>
                            <input id="create-intermediate" type="radio" name="difficulty" value="intermediate">
                            <label for="create-advanced">advanced</label>
                            <input id="create-advanced" type="radio" name="difficulty" value="advanced">
                          </fieldset>
                          <input class="btn" type="submit" name="submit" value="SUBMIT">
                        </form>
                    </div>
                  </div>
                  <div class="column col-6">
                    <pre>
                      <code id="resources-create-form-result"></code>
                    </pre>
                  </div>
                </div>
            </article>

          </section> <!--  End section -->


    </main>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/core-js/2.1.4/core.min.js"></script>
    <script src="//unpkg.com/@feathersjs/client@^3.0.0/dist/feathers.js"></script>
    <script>
      var app = feathers();
      // Connect to a different URL
      var restClient = feathers.rest('http://localhost:3030')

      // Configure an AJAX library (see below) with that client
      app.configure(restClient.fetch(window.fetch));

      // Connect to the `http://localhost:3030/resources` service
      const resources = app.service('resources');
      const sections = app.service('sections');
      const playlists = app.service('playlists');


      /**
       * RESOURCE API CALLS
       */
      class ResourceAPI {
        constructor(){

          this.findAll = this.findAll.bind(this);
          this.findById = this.findById.bind(this);
          this.create = this.create.bind(this);
        }


        /**
         * findAll()
         * returns all the resources
         */
         async findAll(){
           try{
             let response = await resources.find({});
             return response;
           } catch(err){
             return err;
           }
        }

        /**
         * findById()
         * find 1 resource by the id
         * { query: { status: 'read', user: '10' } }
         */
        async findById(id){
          try{
            let response = await resources.find({
              query:{
                _id:id
              }
            });
            return response;
          } catch(err){
            return err
          }
        }

        /**
         * create()
         * find 1 resource by the id
         * { query: { status: 'read', user: '10' } }
         */
        async create(resourceObj){
          try{
            let response = await resources.create(resourceObj);
            return response;
          } catch(err){
            return err
          }
        }

        /**
         * findById()
         * find 1 resource by the id
         * { query: { status: 'read', user: '10' } }
         */
        async deleteById(id){
          try{
            let response = await resources.delete({
              query:{
                _id:id
              }
            });
            return response;
          } catch(err){
            return err
          }
        }



      }

      const resourceAPI = new ResourceAPI();



      // resources-findAll
      document.querySelector("#resources-findAll").addEventListener("click", async function(e){
        let result = await resourceAPI.findAll();

        document.querySelector("#resources-findAll-result").innerHTML = JSON.stringify(result.data);
      })

      // resources-findById
      document.querySelector("#resources-findById").addEventListener("click", async function(e){
        let result = await resourceAPI.findById("5bc507165686ad95c5929953");
        document.querySelector("#resources-findbyId-result").innerHTML = JSON.stringify(result.data);
      })



      document.querySelector("#resources-create").addEventListener("click", async function(e){
        let dummyResourceData = {
          title:"Test from API, Random Number: " + Math.random()*100,
          description: "Test from API, Random Number: " + Math.random()*100,
          url:"DELETEME",
          keywords: ["TEST", "TEST"],
          difficulty:["BEGINNER"],
          imageUrl:"https://raw.githubusercontent.com/knittingmachine/knittingmachine-docs/master/docs/concept/illustrations/img/frustrated-student.png"
        }

        let result = await resourceAPI.create(dummyResourceData);
        document.querySelector("#resources-create-result").innerHTML = JSON.stringify(result);
      })


      document.querySelector("#resources-create-form").addEventListener("submit", async function(e){
        e.preventDefault();

        console.log(e.target);
        let form = new FormData(e.target)

        let dummyResourceData = {
          title: form.get("title"),
          description: form.get("description"),
          url: form.get("url"),
          keywords:["TEST", "AUTOMATED"],
          difficulty: form.get("difficulty"),
          imageUrl: form.get("imageUrl")
        }

        let result = await resourceAPI.create(dummyResourceData);
        document.querySelector("#resources-create-form-result").innerHTML = JSON.stringify(result);
      })


      // resourceAPI.create(dummyResourceData).then((data, err)=>{
      //   console.log(data);
      // });


    </script>
  </body>
</html>
